{"ast":null,"code":"import _defineProperty from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/* eslint react/no-multi-comp: 0, react/prop-types: 0 */ // Packages\nimport React from'react';import{Button,Modal,ModalHeader,ModalBody,FormGroup,Label,Input,CustomInput,TabContent,TabPane}from'reactstrap';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faCircleNotch}from'@fortawesome/free-solid-svg-icons';import ButtonMaterial from'@material-ui/core/Button';import TextField from'@material-ui/core/TextField';// Styles\nimport\"./ModalLogin.scss\";// Data\nimport data from'./data.json';import PingAuthN from'../Integration/PingAuthN';/* PING INTEGRATION */import Session from'../Utils/Session';/* PING INTEGRATION: */import ModalLoginPassword from'../ModalLoginPassword/ModalLoginPassword';/* PING INTEGRATION: */var ModalLogin=/*#__PURE__*/function(_React$Component){_inherits(ModalLogin,_React$Component);var _super=_createSuper(ModalLogin);function ModalLogin(){var _this;_classCallCheck(this,ModalLogin);_this=_super.call(this);_this.deviceExists=function(type){var deviceFound=false;var deviceListFlat=_this.state.deviceList.flat();if(deviceListFlat.indexOf(type)>-1){deviceFound=true;}return deviceFound;};_this.state={isOpen:false,activeTab:'1',loginMethodUnset:true,loginMethodFormGroupClass:'',deviceRef:\"\",/* PING INTEGRATION: Selected device's Id */deviceName:\"\",/* PING INTEGRATION: Device name if using mobile app. I.e. iPhone XS Max */loginMethod:\"\",/* PING INTEGRATION: SMS, Email, iPhone, TOTP */loginTarget:\"\",/* PING INTEGRATION: number or email of selected login method. */deviceList:[],/* PING INTEGRATION: */otp:\"\",/* PING INTEGRATION: */userName:'',/* PING INTEGRATION */email:''/* PING INTEGRATION */};_this.PingAuthN=new PingAuthN();/* PING INTEGRATION: */_this.Session=new Session();/* PING INTEGRATION: */return _this;}/* BEGIN PING INTEGRATION: */ // function as class property. // Note: Per reactjs.org this syntax is experimental and not standardized yet. (Stage 3 proposal).\n//Used to update device selection tabPane based on user's list of paired devices.\n_createClass(ModalLogin,[{key:\"onClosed\",/* END PING INTEGRATION: */value:function onClosed(){this.setState({activeTab:'1',loginMethodUnset:true,deviceRef:\"\",/* PING INTEGRATION: */loginMethod:\"\",/* PING INTEGRATION: */deviceList:[],/* PING INTEGRATION: */loginTarget:\"\",/* PING INTEGRATION: */loginMethodFormGroupClass:''// Doubt we need this. See comment below on same var.\n});}},{key:\"toggle\",value:function toggle(tab){this.setState({isOpen:!this.state.isOpen});/* BEGIN PING INTEGRATION: calling from NavbarMain upon return.\n    Can't call toggleTab or we'll end up in endless loop. */ //TODO better explanation needs to be here. WTF?\nif(tab=='4'){this.setState({activeTab:tab});}/* END PING INTEGRATION: */}},{key:\"toggleTab\",value:function toggleTab(tab){this.setState({activeTab:tab});}},{key:\"setLoginMethod\",value:function setLoginMethod(event){/* BEGIN PING INTEGRATION: had to make this kind of polymorphic due to a late feature add of the \"default device\" concept in P1MFA. */var deviceSelection=\"\";var deviceId=\"\";var deviceRefIndex;var target=\"\";var name=\"\";var deviceList=this.state.deviceList;if(typeof event===\"string\"){//This will be the defaulted device Id.\ndeviceId=event;deviceRefIndex=deviceList.findIndex(function(element,index){return element.includes(deviceId);});deviceSelection=deviceList[deviceRefIndex][0];}else{//We got the selected device from the user in the device selection UI.\nvar delimiterPos=event.target.id.lastIndexOf(\"_\");deviceSelection=event.target.id.substring(delimiterPos+1);deviceRefIndex=deviceList.findIndex(function(element,index){return element.includes(deviceSelection);});deviceId=deviceList[deviceRefIndex][1];}deviceRefIndex=deviceList.findIndex(function(element,index){return element.includes(deviceSelection);});target=deviceList[deviceRefIndex][2];name=deviceList[deviceRefIndex][3];this.setState(function(previousState){//TODO not referencing previousState anymore. should get rid of this and just do standard setState instead of arrow function.\nreturn{deviceRef:deviceId,loginTarget:target,loginMethod:deviceSelection,deviceName:name,loginMethodUnset:false,loginMethodFormGroupClass:'form-group-light'//Doubt we need this. Was probably T3 placeholder since they didn't know how we would Implement Ping integration.\n};});/* END PING INTEGRATION: */}// BEGIN PING INTEGRATIONS\n},{key:\"handleIDChange\",value:function handleIDChange(event){// grabbing whatever the user is typing in the ID first form as they type, and\n// saving it to state. (Controlled input).\nthis.setState({userName:event.target.value.trim()});}},{key:\"handleOTPChange\",value:function handleOTPChange(event){// grabbing whatever the user is typing in the OTP form as they type, and\n// saving it to state. (Controlled input).\nthis.setState({otp:event.target.value});}},{key:\"handleEmailChange\",value:function handleEmailChange(event){//This is not used since PF is handling SSPR to demo Velocity templates.\n// Keeping it here in case Velocity templates get nixed from demos.\n// Grabbing whatever the user is typing in the email form as they type, and\n// saving it to state.\nthis.setState({email:event.target.value});}// When user clicks \"Next\".\n// Handler for various TabPane UIs.\n// TODO T3 used numeric IDs for the TabPanes in render(). With our handler, \n// it would be easier to visually map in the code if they had text IDs related to the UI of the TabPane. I.e. \"IDF\", \"Devices\", etc.\n},{key:\"handleSubmit\",value:function handleSubmit(tab){var _this2=this;//Need to parse this as JSON because the browser's sessionStorage object only stores strings.\nvar cachedFlowResponse=JSON.parse(this.Session.getAuthenticatedUserItem(\"flowResponse\"));if(window.location.search){/* TODO what do we do if they submit with no querystring? Is that even possible? If not, do we even need the test for window.location.search??? */var payload=\"\";switch(tab){case\"1\":// IDF form. This is the default state. Will probably never be called from here.\nthis.toggleTab(\"1\");break;case\"2\"://Password modal or device selection. If password, we toggle to a new UI.\npayload=this.state.userName;this.PingAuthN.handleAuthNflow({flowResponse:cachedFlowResponse,body:payload}).then(function(response){return response.json();}).then(function(jsonResult){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResult));if(jsonResult.status===\"USERNAME_PASSWORD_REQUIRED\"){//Close ModalLogin. We need to get password.\n_this2.toggle();//swap modals for username/password modal.\n_this2.refs.modalLoginPassword.toggle(_this2.state.userName);}else if(jsonResult.status===\"AUTHENTICATION_REQUIRED\"){_this2.PingAuthN.handleAuthNflow({flowResponse:jsonResult,body:\"\"}).then(function(response){return response.json();}).then(function(jsonResponse){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResponse));// We always get back a list of devices whether they have a default or not.\nvar devices=jsonResponse.devices.map(function(device){return[device.type,device.id,device.target,device.name];});_this2.setState({deviceList:devices});//Because we might have a default device in P1MFA.\nif(jsonResponse.selectedDeviceRef){_this2.setLoginMethod(jsonResponse.selectedDeviceRef.id);}if(jsonResponse.status===\"DEVICE_SELECTION_REQUIRED\"){_this2.toggleTab(tab);//If we're below here it's because the user has a default device in P1MFA.\n}else if(jsonResponse.status===\"OTP_REQUIRED\"){_this2.toggleTab(\"3\");}else{// This assumes their default device response was PUSH_CONFIRMATION_WAITING\n_this2.toggleTab(\"7\");_this2.handleSubmit(\"7\");}});}}).catch(function(e){console.error(\"handleAuthNflow exception:\",e);});break;case\"3\":payload=this.state.deviceRef;this.PingAuthN.handleAuthNflow({flowResponse:cachedFlowResponse,body:payload}).then(function(response){return response.json();}).then(function(jsonResult){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResult));//TODO is there a better solution for this?\nif(jsonResult.status===\"OTP_REQUIRED\"){_this2.toggleTab(tab);}else if(jsonResult.status===\"PUSH_CONFIRMATION_WAITING\"){_this2.handleSubmit(\"7\");}}).catch(function(e){console.error(\"handleAuthNflow exception:\",e);});break;case\"4\"://Tab 4 is forgot username, so send them to PF endpoint so we can demo Velocity templates.\nwindow.location.assign(data.pfAcctRecoveryURI);break;case\"5\":// We should never hit this case since PF is handling SSPR.\n// Need implementation if we move SSPR to authN API.\nthis.toggleTab(tab);break;case\"6\":// Tab 6 is newly created for OTP submitted/success.\npayload=this.state.otp;this.toggleTab(tab);this.PingAuthN.handleAuthNflow({flowResponse:cachedFlowResponse,body:payload}).then(function(response){return response.json();}).then(function(jsonResponse){if(jsonResponse.status){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResponse));}if(jsonResponse.status===\"MFA_COMPLETED\"){_this2.PingAuthN.handleAuthNflow({flowResponse:jsonResponse,body:\"\"}).then(function(response){return response.json();}).then(function(jsonResult){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResult));//TODO is there a better solution for this?\nif(jsonResult.status===\"RESUME\"){_this2.PingAuthN.handleAuthNflow({flowResponse:jsonResult});}});}else{console.log(\"DEBUG\",JSON.stringify(jsonResponse));// User got the OTP wrong. Try again.\n_this2.toggleTab(\"3\");}}).catch(function(e){console.error(\"handleAuthNflow exception:\",e);});break;case\"7\":// Tab 7 is newly created for mobile push sent/success.\nthis.toggleTab(tab);var polling=function polling(){_this2.PingAuthN.handleAuthNflow({flowResponse:cachedFlowResponse}).then(function(response){return response.json();}).then(function(jsonResponse){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResponse));if(jsonResponse.status===\"MFA_COMPLETED\"){_this2.PingAuthN.handleAuthNflow({flowResponse:jsonResponse,body:\"\"}).then(function(response){return response.json();}).then(function(jsonResult){var success=_this2.Session.setAuthenticatedUserItem(\"flowResponse\",JSON.stringify(jsonResult));//TODO is there a better solution for this?\nif(jsonResult.status===\"RESUME\"){window.clearInterval(pollingID);_this2.PingAuthN.handleAuthNflow({flowResponse:jsonResult});}});}}).catch(function(e){console.error(\"handleAuthNflow exception:\",e);});};var pollingID=window.setInterval(polling,3000);break;}}}},{key:\"componentDidMount\",value:function componentDidMount(){var rememberMe=this.Session.getCookie(\"rememberMe\");if(rememberMe.length){this.setState({userName:rememberMe});}}// END PING INTEGRATIONS\n},{key:\"render\",value:function render(){var _this3=this,_React$createElement,_React$createElement2,_React$createElement3,_React$createElement4;var closeBtn=/*#__PURE__*/React.createElement(\"div\",null);return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Modal,{isOpen:this.state.isOpen,toggle:this.toggle.bind(this),onClosed:this.onClosed.bind(this),className:\"modal-login\"},/*#__PURE__*/React.createElement(ModalBody,null,/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"img\",{className:'modalHeoLogo',src:process.env.PUBLIC_URL+\"/images/logo.png\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(TabContent,{activeTab:this.state.activeTab},/*#__PURE__*/React.createElement(TabPane,{tabId:\"1\"},/*#__PURE__*/React.createElement(\"h4\",null,data.titles.welcome),/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group-light\"},/*#__PURE__*/React.createElement(TextField,{classes:{root:'dropDownTextField'},InputProps:{classes:{root:'inputRootDropDown',underline:'inputUnderlineDropDown',focused:'inputFocusedDropDown'}},InputLabelProps:{classes:{root:'trackingLabelDropDown',focused:'inputLabelFocusedDropDown'}}// label={data.form.fields.username.placeholder}\n,label:'User Id',variant:\"filled\",value:this.state.userName,onChange:this.handleIDChange.bind(this)})),/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group-light\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(ButtonMaterial,{classes:{root:'submitButtonModal',text:'submitButtonLabel'},onClick:function onClick(){_this3.handleSubmit('2');},variant:\"text\"},data.form.buttons.next)),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"link\",size:\"sm\",className:\"text-info pl-0\",onClick:function onClick(){_this3.handleSubmit('4');}},data.form.buttons.reset),\" \")),/*#__PURE__*/React.createElement(TabPane,{tabId:\"2\"},/*#__PURE__*/React.createElement(\"h4\",null,data.titles.login_method),/*#__PURE__*/React.createElement(FormGroup,{className:this.state.loginMethodFormGroupClass},/*#__PURE__*/React.createElement(\"div\",null,this.deviceExists(\"iPhone\")&&/*#__PURE__*/React.createElement(CustomInput,{type:\"radio\",id:\"login_method_iPhone\",name:\"login_method\",label:data.form.fields.login_method.options.faceid,className:\"form-check-inline\",onClick:this.setLoginMethod.bind(this)}),this.deviceExists(\"SMS\")&&/*#__PURE__*/React.createElement(CustomInput,{type:\"radio\",id:\"login_method_SMS\",name:\"login_method\",label:data.form.fields.login_method.options.text,className:\"form-check-inline\",onClick:this.setLoginMethod.bind(this)}),this.deviceExists(\"Email\")&&/*#__PURE__*/React.createElement(CustomInput,{type:\"radio\",id:\"login_method_Email\",name:\"login_method\",label:data.form.fields.login_method.options.email,className:\"form-check-inline\",onClick:this.setLoginMethod.bind(this)}))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-4 text-center\"},/*#__PURE__*/React.createElement(ButtonMaterial,{classes:{root:'submitButtonModal',text:'submitButtonLabel'},onClick:function onClick(){_this3.handleSubmit(\"3\");},variant:\"text\"},data.form.buttons.login)),/*#__PURE__*/React.createElement(\"div\",{className:\"text-center\"},/*#__PURE__*/React.createElement(Button,(_React$createElement={className:\"submitButtonModal\",type:\"button\",color:\"link\",size:\"sm\"},_defineProperty(_React$createElement,\"className\",\"text-info\"),_defineProperty(_React$createElement,\"onClick\",this.toggle.bind(this)),_React$createElement),data.form.buttons.help))),/*#__PURE__*/React.createElement(TabPane,{tabId:\"3\"},\" \",\"Using \",this.state.loginMethod,\" at \",this.state.loginTarget,\".\",/*#__PURE__*/React.createElement(\"div\",{className:\"mobile-loading\",style:{backgroundImage:\"url(\".concat(process.env.PUBLIC_URL,\"/images/login-device-outline.jpg)\")}},/*#__PURE__*/React.createElement(\"div\",{className:\"spinner\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faCircleNotch,size:\"3x\",className:\"fa-spin\"})),/*#__PURE__*/React.createElement(\"p\",null,data.mobile.loading)),this.state.loginMethod!==\"iPhone\"&&/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group-light\"},/*#__PURE__*/React.createElement(Label,{for:\"otp\"},data.form.fields.otp.label),/*#__PURE__*/React.createElement(TextField,{classes:{root:'dropDownTextField'},InputProps:{classes:{root:'inputRootDropDown',underline:'inputUnderlineDropDown',focused:'inputFocusedDropDown'}},InputLabelProps:{classes:{root:'trackingLabelDropDown',focused:'inputLabelFocusedDropDown'}}// label={data.form.fields.username.placeholder}\n,label:data.form.fields.otp.placeholder,variant:\"filled\",value:this.state.otp,onChange:this.handleOTPChange.bind(this)})),this.state.loginMethod!==\"iPhone\"&&/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(ButtonMaterial,{classes:{root:'submitButtonModal',text:'submitButtonLabel'},onClick:function onClick(){_this3.handleSubmit('6');},variant:\"text\"},data.form.buttons.next)),/*#__PURE__*/React.createElement(\"div\",{className:\"mt-4 text-center\"},/*#__PURE__*/React.createElement(Button,(_React$createElement2={className:\"submitButtonModal\",type:\"button\",color:\"link\",size:\"sm\"},_defineProperty(_React$createElement2,\"className\",\"text-info\"),_defineProperty(_React$createElement2,\"onClick\",this.toggle.bind(this)),_React$createElement2),data.form.buttons.help))),/*#__PURE__*/React.createElement(TabPane,{tabId:\"4\"},/*#__PURE__*/React.createElement(\"h4\",null,data.form.buttons.recover_username),/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group-light\"},/*#__PURE__*/React.createElement(Label,{for:\"email\"},data.form.fields.email.label),/*#__PURE__*/React.createElement(Input,{onChange:this.handleEmailChange.bind(this),type:\"text\",name:\"email\",id:\"email\",placeholder:data.form.fields.email.placeholder}),/*#__PURE__*/React.createElement(TextField,{classes:{root:'dropDownTextField'},InputProps:{classes:{root:'inputRootDropDown',underline:'inputUnderlineDropDown',focused:'inputFocusedDropDown'}},InputLabelProps:{classes:{root:'trackingLabelDropDown',focused:'inputLabelFocusedDropDown'}}// label={data.form.fields.username.placeholder}\n,label:data.form.fields.email.placeholder,variant:\"filled\",onChange:this.handleEmailChange.bind(this)})),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(ButtonMaterial,{classes:{root:'submitButtonModal',text:'submitButtonLabel'},onClick:function onClick(){_this3.handleSubmit('5');},variant:\"text\"},data.form.buttons.recover_username))),/*#__PURE__*/React.createElement(TabPane,{tabId:\"5\"},/*#__PURE__*/React.createElement(\"h4\",null,data.titles.recover_username_success),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3 text-center\"},/*#__PURE__*/React.createElement(ButtonMaterial,{classes:{root:'submitButtonModal',text:'submitButtonLabel'},onClick:function onClick(){_this3.handleSubmit('1');},variant:\"text\"},data.form.buttons.login))),/*#__PURE__*/React.createElement(TabPane,{tabId:\"6\"},/*#__PURE__*/React.createElement(\"h4\",null,data.titles.otp_success),/*#__PURE__*/React.createElement(\"div\",{className:\"mt-4 text-center\"},/*#__PURE__*/React.createElement(Button,(_React$createElement3={className:\"submitButtonModal\",type:\"button\",color:\"link\",size:\"sm\"},_defineProperty(_React$createElement3,\"className\",\"text-info\"),_defineProperty(_React$createElement3,\"onClick\",this.toggle.bind(this)),_React$createElement3),data.form.buttons.help))),/*#__PURE__*/React.createElement(TabPane,{tabId:\"7\"},\" \",\"Using your \",this.state.deviceName?this.state.deviceName:this.state.loginMethod,\".\",/*#__PURE__*/React.createElement(\"h4\",{\"data-toggle\":\"tooltip\",title:\"See what we did there?\"},data.titles.mobile_success),/*#__PURE__*/React.createElement(\"div\",{className:\"mt-4 text-center\"},/*#__PURE__*/React.createElement(Button,(_React$createElement4={className:\"submitButtonModal\",type:\"button\",color:\"link\",size:\"sm\"},_defineProperty(_React$createElement4,\"className\",\"text-info\"),_defineProperty(_React$createElement4,\"onClick\",this.toggle.bind(this)),_React$createElement4),data.form.buttons.help))))))),/*#__PURE__*/React.createElement(ModalLoginPassword,{ref:\"modalLoginPassword\"}));}}]);return ModalLogin;}(React.Component);export default ModalLogin;","map":null,"metadata":{},"sourceType":"module"}