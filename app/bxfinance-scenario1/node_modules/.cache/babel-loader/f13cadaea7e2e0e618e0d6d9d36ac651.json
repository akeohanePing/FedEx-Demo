{"ast":null,"code":"import _regeneratorRuntime from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import Session from'../Utils/Session';/**\nPING INTEGRATION:\nThis entire component is Ping developed.\nImplements functions to integrate with PingFederate\nOAuth-related API endpoints.\n\n@author Michael Sanchez\n*/var PingOAuth=/*#__PURE__*/function(){function PingOAuth(){_classCallCheck(this,PingOAuth);this.pfAuthZAPIURI=\"/as/authorization.oauth2?\";this.pfTokenAPIURI=\"/as/token.oauth2?\";this.Session=new Session();}// Didn't abstract these since they shouldn't ever change.\n_createClass(PingOAuth,[{key:\"getAuthCode\",/** \n    Get AuthZ Code:\n    We defaulted all params except for uid, \n    which is user specifc. As a demo site, we only have 1\n    auth code client. But if we add more in the future, this\n    will already support that.\n\n    @param {string} client The OAuth client. Default is pa_wam .\n    @param {string} responseType The OAuth client-supported response type. Default is code.\n    @param {string} redirectURI The OAuth client-allowed redirect URI(s). Default is https://demo.bxfinance.org/app/banking .\n    @param {string} scopes Optional OAuth scopes. Default is an empty string.\n    @return {string} AuthZ code.\n    */value:function(){var _getAuthCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref,_ref$client,client,_ref$responseType,responseType,_ref$redirectURI,redirectURI,_ref$scopes,scopes,myHeaders,urlEncodedBody,requestOptions,url,response,authCode,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref=_args.length>0&&_args[0]!==undefined?_args[0]:{},_ref$client=_ref.client,client=_ref$client===void 0?\"pa_wam\":_ref$client,_ref$responseType=_ref.responseType,responseType=_ref$responseType===void 0?\"code\":_ref$responseType,_ref$redirectURI=_ref.redirectURI,redirectURI=_ref$redirectURI===void 0?process.env.REACT_APP_HOST+\"/app/banking\":_ref$redirectURI,_ref$scopes=_ref.scopes,scopes=_ref$scopes===void 0?\"\":_ref$scopes;console.info(\"PingOAuth.js\",\"Getting an auth code for the getToken() call.\");myHeaders=new Headers();myHeaders.append(\"Content-Type\",\"application/x-www-form-urlEncodedBody\");myHeaders.append(\"Authorization\",\"Basic cGFfd2FtOjJGZWRlcmF0ZU0wcmU=\");urlEncodedBody=new URLSearchParams();requestOptions={method:'POST',headers:myHeaders,body:urlEncodedBody,redirect:'follow'};url=this.pfAuthZAPIURI+\"response_type=\"+responseType+\"&client_id=\"+client+\"&redirect_uri=\"+redirectURI+\"&scope=\"+scopes;_context.next=10;return fetch(url,requestOptions);case 10:response=_context.sent;authCode=response.url.substring(response.url.search(\"=\")+1);return _context.abrupt(\"return\",authCode);case 13:case\"end\":return _context.stop();}}},_callee,this);}));function getAuthCode(){return _getAuthCode.apply(this,arguments);}return getAuthCode;}()/** \n    Get Token:\n    We defaulted all params except for code,\n    which is code flow specifc. As a demo site, we only have 1\n    auth code client. But if we add more in the future, this\n    will already support that.\n\n    @param {string} client The OAuth client. Default is pa_wam .\n    @param {string} responseType The OAuth client-supported response type. Default is code.\n    @param {string} redirectURI The OAuth client-allowed redirect URI(s). Default is https://demo.bxfinance.org/app/banking .\n    @param {string} scopes Optional OAuth scopes. Default is an empty string.\n    @return {string} OAuth access token, base64 encoded.\n    */},{key:\"getToken\",value:function(){var _getToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _ref2,uid,_ref2$client,client,_ref2$responseType,responseType,_ref2$redirectURI,redirectURI,_ref2$scopes,scopes,authCode,grantType,_myHeaders,_requestOptions,url,response,jsonData,token,_grantType,myHeaders,urlencoded,requestOptions,_url,_response,_jsonData,_token,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref2=_args2.length>0&&_args2[0]!==undefined?_args2[0]:{},uid=_ref2.uid,_ref2$client=_ref2.client,client=_ref2$client===void 0?\"pa_wam\":_ref2$client,_ref2$responseType=_ref2.responseType,responseType=_ref2$responseType===void 0?\"code\":_ref2$responseType,_ref2$redirectURI=_ref2.redirectURI,redirectURI=_ref2$redirectURI===void 0?process.env.REACT_APP_HOST+\"/app/banking\":_ref2$redirectURI,_ref2$scopes=_ref2.scopes,scopes=_ref2$scopes===void 0?\"\":_ref2$scopes;console.info(\"PingOAuth.js\",\"Getting a token.\");if(!(responseType==\"code\")){_context2.next=26;break;}console.info(\"PingAuthN.js\",\"Using auth code grant\");_context2.next=6;return this.getAuthCode({uid:this.Session.getAuthenticatedUserItem(\"uid\"),scopes:scopes});case 6:authCode=_context2.sent;grantType=\"authorization_code\";_myHeaders=new Headers();_myHeaders.append(\"Content-Type\",\"application/x-www-form-urlEncodedBody\");_myHeaders.append(\"Authorization\",\"Basic cGFfd2FtOjJGZWRlcmF0ZU0wcmU=\");_requestOptions={method:'POST',headers:_myHeaders,redirect:'follow'};url=this.pfTokenAPIURI+\"grant_type=\"+grantType+\"&redirect_uri=\"+redirectURI+\"&code=\"+authCode;_context2.next=15;return fetch(url,_requestOptions);case 15:response=_context2.sent;_context2.next=18;return response.json();case 18:jsonData=_context2.sent;_context2.next=21;return jsonData.access_token;case 21:token=_context2.sent;console.info(\"PingOAuth.js\",\"TOKEN: \"+token);return _context2.abrupt(\"return\",token);case 26:if(!(client==\"marketingApp\"||client==\"anywealthadvisorApp\")){_context2.next=50;break;}console.info(\"PingAuthN.js\",\"Using client credentials grant\");_grantType=\"client_credentials\";myHeaders=new Headers();myHeaders.append(\"Content-Type\",\"application/x-www-form-urlencoded\");myHeaders.append(\"username\",uid);urlencoded=new URLSearchParams();urlencoded.append(\"client_id\",client);urlencoded.append(\"client_secret\",\"2Federate\");requestOptions={method:'POST',headers:myHeaders,body:urlencoded,redirect:'follow'};_url=this.pfTokenAPIURI+\"grant_type=\"+_grantType;_context2.next=39;return fetch(_url,requestOptions);case 39:_response=_context2.sent;_context2.next=42;return _response.json();case 42:_jsonData=_context2.sent;_context2.next=45;return _jsonData.access_token;case 45:_token=_context2.sent;console.info(\"PingAuthN.js Token =\",_token);return _context2.abrupt(\"return\",_token);case 50:throw new Error(\"PingOAuth.js\",\"Unexpected response_type or client exception in getToken().\");case 51:case\"end\":return _context2.stop();}}},_callee2,this);}));function getToken(){return _getToken.apply(this,arguments);}return getToken;}()}]);return PingOAuth;}();;export default PingOAuth;","map":null,"metadata":{},"sourceType":"module"}