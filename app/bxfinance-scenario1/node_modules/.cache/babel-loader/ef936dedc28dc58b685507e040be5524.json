{"ast":null,"code":"import _classCallCheck from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/andrewkeohane/Documents/fedex/BXFinance-Apps/bxfinance-scenario1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Container,Button,Form,FormGroup,Label,CustomInput}from'reactstrap';import classNames from\"classnames\";// Components\nimport NavbarMain from'../../components/NavbarMain';import WelcomeBar from'../../components/WelcomeBar';import FooterMain from'../../components/FooterMain';import AccountsSubnav from'../../components/AccountsSubnav';import AccountsDropdown from'../../components/AccountsDropdown';import AccountsSectionNav from'../../components/AccountsSectionNav';import CardRewards from'../../components/CardRewards';import Session from'../../components/Utils/Session';/* PING INTEGRATION: */import PingOAuth from'../../components/Integration/PingOAuth';/* PING INTEGRATION: */import PingData from'../../components/Integration/PingData';/* PING INTEGRATION: */ // Data\nimport data from'../../data/profile-settings/communication-preferences.json';import pingEndpoints from'../../data/ping-endpoints.json';/* PING INTEGRATION: */ // Styles\nimport\"../../styles/pages/profile-settings/communication-preferences.scss\";var CommunicationPreferences=/*#__PURE__*/function(_React$Component){_inherits(CommunicationPreferences,_React$Component);var _super=_createSuper(CommunicationPreferences);function CommunicationPreferences(props){var _this;_classCallCheck(this,CommunicationPreferences);_this=_super.call(this,props);_this.state={step:1,sms:false,/* PING INTEGRATION: */smsChecked:false,/* PING INTEGRATION: */email:false,/* PING INTEGRATION: */emailChecked:false,/* PING INTEGRATION: */mail:false,/* PING INTEGRATION: */mailChecked:false,/* PING INTEGRATION: */consentId:\"0\"};_this.showStep2=_this.showStep2.bind(_assertThisInitialized(_this));_this.close=_this.close.bind(_assertThisInitialized(_this));_this.toggleConsent=_this.toggleConsent.bind(_assertThisInitialized(_this));/* PING INTEGRATION: */_this.Session=new Session();/* PING INTEGRATION: */_this.PingOAuth=new PingOAuth();/* PING INTEGRATION: */_this.PingData=new PingData();/* PING INTEGRATION: */_this.consentDef=\"share-comm-preferences\";/* PING INTEGRATION: */return _this;}_createClass(CommunicationPreferences,[{key:\"showStep2\",value:function showStep2(){/* BEGIN PING INTEGRATION */if(this.state.consentId!==\"0\"){//Updating existing consent record.\nvar consent={\"sms\":this.state.sms,\"email\":this.state.email,\"homeAddress\":this.state.mail};this.PingData.updateUserConsent(this.Session.getAuthenticatedUserItem(\"AT\"),consent,this.state.consentId,this.consentDef).then(function(response){return response.json();}).then(function(consentData){console.info(\"Updated user consent\",JSON.stringify(consentData));}).catch(function(e){console.error(\"UpdateUserConsents Exception\",e);});}else{//Creating new consent record.\nvar _consent={\"sms\":this.state.sms,\"email\":this.state.email,\"homeAddress\":this.state.mail};this.PingData.createUserConsent(this.Session.getAuthenticatedUserItem(\"AT\"),_consent,this.Session.getAuthenticatedUserItem(\"uid\"),this.consentDef).then(function(response){return response.json();}).then(function(consentData){console.info(\"Created user consent\",JSON.stringify(consentData));}).catch(function(e){console.error(\"CreateUserConsents Exception\",e);});}/* END PING INTEGRATION */this.setState({step:2});}},{key:\"close\",value:function close(){this.setState({step:1});}/* BEGIN PING INTEGRATION:  */ //this function sets state of comm. pref. selected soley based on event obj passed in during onclick.\n// we extract the comm. type and consent pref. based on the substrings of the element ID. I.e \"sms_yes\".\n},{key:\"toggleConsent\",value:function toggleConsent(event){var consentState={};var checkedState={};var delimiterPos=event.target.id.indexOf(\"_\");consentState[event.target.id.substring(0,delimiterPos)]=event.target.id.substring(delimiterPos+1)==\"yes\"?true:false;this.setState(consentState);checkedState[event.target.id.substring(0,delimiterPos)+\"Checked\"]=event.target.id.substring(delimiterPos+1)==\"yes\"?true:false;this.setState(checkedState);}/* END PING INTEGRATION:  */ /* BEGIN PING INTEGRATION */},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(this.Session.getAuthenticatedUserItem(\"AT\")){var token=this.Session.getAuthenticatedUserItem(\"AT\");this.PingData.getUserConsents(token,this.Session.getAuthenticatedUserItem(\"uid\"),this.consentDef).then(function(response){return response.json();}).then(function(consentData){if(consentData.count>0){_this2.setState({// TODO this is probably overkill having a checked version of the consent. You could probably infer from the consent value.\nsms:consentData._embedded.consents[0].data.sms,email:consentData._embedded.consents[0].data.email,mail:consentData._embedded.consents[0].data.homeAddress,smsChecked:consentData._embedded.consents[0].data.sms==true?true:false,emailChecked:consentData._embedded.consents[0].data.email==true?true:false,mailChecked:consentData._embedded.consents[0].data.homeAddress==true?true:false,consentId:consentData._embedded.consents[0].id});}}).catch(function(e){console.error(\"GetUserConsents Exception\",e);});}else{this.PingOAuth.getToken({uid:this.Session.getAuthenticatedUserItem(\"uid\"),scopes:'urn:pingdirectory:consent'}).then(function(token){_this2.Session.setAuthenticatedUserItem(\"AT\",token);//for later reuse to reduce getToken calls.\n_this2.PingData.getUserConsents(token,_this2.Session.getAuthenticatedUserItem(\"uid\"),_this2.consentDef).then(function(response){return response.json();}).then(function(consentData){if(consentData.count>0){_this2.setState({sms:consentData._embedded.consents[0].data.sms,email:consentData._embedded.consents[0].data.email,mail:consentData._embedded.consents[0].data.homeAddress,smsChecked:consentData._embedded.consents[0].data.sms==true?true:false,emailChecked:consentData._embedded.consents[0].data.email==true?true:false,mailChecked:consentData._embedded.consents[0].data.homeAddress==true?true:false,consentId:consentData._embedded.consents[0].id});}}).catch(function(e){console.error(\"GetUserConsents Exception\",e);});}).catch(function(e){console.error(\"GetToken Exception\",e);});}}/* END PING INTEGRATION */},{key:\"render\",value:function render(){var _this3=this;var commDetails,commType;return/*#__PURE__*/React.createElement(\"div\",{className:\"accounts communication-preferences\"},/*#__PURE__*/React.createElement(NavbarMain,null),/*#__PURE__*/React.createElement(WelcomeBar,{firstName:this.Session.getAuthenticatedUserItem(\"firstName\")}),\" \",/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"div\",{className:\"inner\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sidebar\"},Object.keys(data.subnav).map(function(key){return data.subnav[key].title==='Profile & Settings'?/*#__PURE__*/React.createElement(AccountsSubnav,{key:data.subnav[key].title,subnav:data.subnav[key],pingendpoints:pingEndpoints}):null;})),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"accounts-hdr\"},/*#__PURE__*/React.createElement(\"h1\",null,data.title),/*#__PURE__*/React.createElement(AccountsDropdown,{text:data.dropdown})),this.state.step==1&&/*#__PURE__*/React.createElement(\"div\",{className:\"module module-step1\"},/*#__PURE__*/React.createElement(\"h2\",null,data.steps[0].title),/*#__PURE__*/React.createElement(\"p\",null,data.steps[0].description),/*#__PURE__*/React.createElement(\"h3\",null,data.steps[0].table_title),/*#__PURE__*/React.createElement(Form,null,Object.keys(data.steps[0].communication_types).map(function(index){commDetails=data.steps[0].communication_types[index].name==\"sms\"?_this3.Session.getAuthenticatedUserItem(\"mobile\"):data.steps[0].communication_types[index].name==\"email\"?_this3.Session.getAuthenticatedUserItem(\"email\"):_this3.Session.getAuthenticatedUserItem(\"fullAddress\");commType=data.steps[0].communication_types[index].name;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(FormGroup,{key:index,className:classNames({\"gray\":index%2})},/*#__PURE__*/React.createElement(Label,{for:data.steps[0].communication_types[index].name},data.steps[0].communication_types[index].label+'('+commDetails+')'),/*#__PURE__*/React.createElement(CustomInput,{onChange:function onChange(event){return _this3.toggleConsent(event);},type:\"radio\",id:\"\".concat(data.steps[0].communication_types[index].name,\"_yes\"),name:data.steps[0].communication_types[index].name,checked:_this3.state[commType+\"Checked\"],label:\"Yes\"}),/*#__PURE__*/React.createElement(CustomInput,{onChange:function onChange(event){return _this3.toggleConsent(event);},type:\"radio\",id:\"\".concat(data.steps[0].communication_types[index].name,\"_no\"),name:data.steps[0].communication_types[index].name,checked:!_this3.state[commType+\"Checked\"],label:\"No\"})));}),/*#__PURE__*/React.createElement(FormGroup,{className:\"buttons submit-buttons\"},/*#__PURE__*/React.createElement(Button,{color:\"primary\",onClick:this.showStep2},\"Save\"),/*#__PURE__*/React.createElement(\"a\",{href:process.env.PUBLIC_URL+\"/banking/profile-settings\",className:\"text-info cancel\"},\"Cancel\")))),this.state.step==2&&/*#__PURE__*/React.createElement(\"div\",{className:\"module module-step2\"},/*#__PURE__*/React.createElement(\"h2\",{className:\"confirmation\"},data.steps[1].title),/*#__PURE__*/React.createElement(\"p\",null,data.steps[1].description),/*#__PURE__*/React.createElement(\"h3\",null,data.steps[0].table_title),/*#__PURE__*/React.createElement(Form,null,Object.keys(data.steps[1].communication_types).map(function(index){commDetails=data.steps[0].communication_types[index].name==\"sms\"?_this3.Session.getAuthenticatedUserItem(\"mobile\"):data.steps[0].communication_types[index].name==\"email\"?_this3.Session.getAuthenticatedUserItem(\"email\"):_this3.Session.getAuthenticatedUserItem(\"fullAddress\");commType=data.steps[0].communication_types[index].name;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(FormGroup,{key:index,className:classNames({\"gray\":index%2})},/*#__PURE__*/React.createElement(Label,{for:data.steps[0].communication_types[index].name},data.steps[0].communication_types[index].label+'('+commDetails+')'),/*#__PURE__*/React.createElement(CustomInput,{type:\"radio\",id:\"\".concat(data.steps[0].communication_types[index].name,\"_yes\"),name:data.steps[0].communication_types[index].name,checked:_this3.state[commType+\"Checked\"],disabled:true,label:\"Yes\"}),/*#__PURE__*/React.createElement(CustomInput,{type:\"radio\",id:\"\".concat(data.steps[0].communication_types[index].name,\"_no\"),name:data.steps[0].communication_types[index].name,checked:!_this3.state[commType+\"Checked\"],disabled:true,label:\"No\"})));}),/*#__PURE__*/React.createElement(\"div\",{dangerouslySetInnerHTML:{__html:data.steps[1].other_things}}),/*#__PURE__*/React.createElement(FormGroup,{className:\"buttons submit-buttons\"},/*#__PURE__*/React.createElement(Button,{color:\"primary\",onClick:this.close},data.steps[1].btn_back))))))));}}]);return CommunicationPreferences;}(React.Component);export default CommunicationPreferences;","map":null,"metadata":{},"sourceType":"module"}